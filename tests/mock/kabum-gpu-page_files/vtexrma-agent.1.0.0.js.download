async function VTEXAdsInjectCleverAds(e){console.log(`VTEXAds VTEXAdsInjectCleverAds ${e.cleverAdsId}`);const s=e.cleverAdsId;if(!s)return void console.log("VTEXAds cleverAdsId not found.");let t=[];for(let e=0;e<30;e++){if(t=document.querySelectorAll("newtailad"),t.length>=1){console.log(`VTEXAds tags found ${t}`);break}console.log(`VTEXAds waiting tag newtailad ${e}`),await new Promise((e=>setTimeout(e,1e3)))}if(!t||!t.length)return void console.log("VTEXAds: nenhuma tag <newtailad> encontrada.");const i=t[0];i.classList.add("clever-core-ads"),i.style.width="300px",i.style.height="250px",function(e,t){console.log("VTEXAds Injecting Cleverads");var i,o=e.createElement("script"),n=t.frameElement;o.id=s,o.src="https://scripts.cleverwebserver.com/4eb03dd1fe19a0c7441794a10bf4e2f0.js",o.async=!0,o.type="text/javascript",o.setAttribute("data-target",t.name||n&&n.getAttribute("id"));try{i=parent.document.getElementsByTagName("script")[0]||e.getElementsByTagName("script")[0]}catch(e){i=!1}i||(i=e.getElementsByTagName("head")[0]||e.getElementsByTagName("body")[0]),i.parentNode.insertBefore(o,i)}(document,window)}async function VTEXAdsBeaconSender({publisher_id:e,session_id:s,user_id:t,track_id:i,cryptoObj:o,navigatorObj:n,consoleObj:a,documentObj:d}){try{let r=new URLSearchParams(d.location.search);if(!r.get("naid"))return void a.log("VTEX Ads: No naid found");const c=r.get("naid"),l=r.get("ncid"),m=r.get("gadv_id"),u="offsite-"+o.randomUUID(),g="offsite-"+o.randomUUID();for(const o of["click"]){let d=`https://events.newtail-media.newtail.com.br/v1/beacon/${o}/${c}?publisher_id=${e}&ad_type=banner&pname=offsite&context=offsite&event_id=${u}&request_id=${g}&campaign_type=off_site`;l&&(d+=`&campaign_id=${l}`),t&&(d+="&user_id="+t),(m||i)&&(d+="&track_id="+(m||i));const r=JSON.stringify({session_id:s});await n.sendBeacon(d,r),a.log(`VTEX Ads: ${o} beacon sent. url: ${d} - body: ${r}`)}}catch(e){a.log("VTEX Ads: error sending beacon",e)}}function VTEXAdsGetCookieValue(e,s){if(!s||!s.cookie)return null;const t=s.cookie.split("; ");for(const s of t){const[t,i]=s.split("=");if(t===e)return decodeURIComponent(i)}return null}function VTEXAdsGetSessionId(e,s,t){return e?e.cookieSessionName?VTEXAdsGetCookieValue(e.cookieSessionName,s):e.sessionStoreSessionName&&t&&"function"==typeof t.getItem?t.getItem(e.sessionStoreSessionName):(e.cookieSessionName||e.sessionStoreSessionName||console.log("VTEX Ads: Cookie MAC ID name not defined.",e),null):(console.log("VTEX Ads: Cookie MAC ID name not defined.",{}),null)}const GET_MAC_ID_INTERVAL=500;async function VTEXAdsGetSessionIdWithRetry(e,s,t,i=30){let o=null;for(let n=0;n<i&&(o=VTEXAdsGetSessionId(e,s,t),!o);++n)await new Promise((e=>setTimeout(e,GET_MAC_ID_INTERVAL)));return o}async function VTEXAdsAgent(e=window,s=document,t=navigator,i=crypto,o=console,n=sessionStorage){o.log("VTEX Ads - Loaded!");const a="VtexRCMacIdv7",d=["events.newtail-media.newtail.com.br","staging.newtail-media.newtail.com.br"],r=[{domain:["drogariasaopaulo.com.br","drogariaspacheco.com.br"],publisher_id:"b0b09b5b-71db-4c79-a664-601a659a412a",cookieSessionName:a},{domain:"casasbahia.com.br",publisher_id:"3b7bcd3a-fde6-42d1-8de4-47a6e41a415a",cookieSessionName:"sessionId"},{domain:"panvel.com",publisher_id:"eb729f60-c9a2-11ed-bf0e-0a84c5f05565"},{domain:"fastshop.com.br",publisher_id:"974b02b9-bfda-4a7c-ac10-2bd5b1d29a37",cookieSessionName:a},{domain:"americanas.com.br",publisher_id:"4d600792-e73a-4e3f-b7b1-0447b8c4bb94",cookieSessionName:a},{domain:"kabum.com.br",publisher_id:"fc855527-f0b7-4438-b30a-9ea3284241d8",cookieSessionName:"session",cleverAdsId:"CleverCoreLoader84690"},{domain:["paguemenos.com.br","extrafarma.com.br"],publisher_id:"47e240a0-61f7-46fd-8056-81288de6d724",cookieSessionName:a}].find((({domain:s})=>Array.isArray(s)?s.some((s=>e.location.hostname.includes(s))):e.location.hostname.includes(s)));if(!r)return void o.warn("VTEX Ads: Unable to find nopid");VTEXAdsInjectCleverAds(r);try{const t="true"===new URLSearchParams(e.location.search).get("vtexAdsEnableMagicIntegration"),i=Array.isArray(r.domain)?r.domain.some((e=>String(e).includes("casasbahia.com.br"))):String(r.domain||"").includes("casasbahia.com.br");if(t&&i&&s&&"function"==typeof s.createElement){const e="vtexads-magic-1-0-0";if("function"==typeof s.getElementById?s.getElementById(e):null)o.log("VTEX Ads: Magic script already present");else{const t=s.createElement("script");t.id=e,t.src="https://cdn.newtail.com.br/retail-media/scripts/vtexads-magic-1.0.0.js",t.async=!0;const i=s.head&&"function"==typeof s.head.appendChild?s.head:s.body&&"function"==typeof s.body.appendChild?s.body:null;i?(i.appendChild(t),o.log("VTEX Ads: Magic script injected")):o.warn("VTEX Ads: Unable to inject magic script (no head/body available)")}}}catch(e){o.warn("VTEX Ads: Failed to evaluate magic integration condition",e)}let c=await VTEXAdsGetSessionIdWithRetry(r,s,n);if(!c)return void o.warn("VTEX Ads: Unable to find macId after retries.");const l=new URLSearchParams(e.location.search),m=l.get("va_utm");if(m)try{const e=decodeURIComponent(m.replace("/view/","/click/")),s=new URL(e);if(!d.some((e=>s.hostname.includes(e))))return void o.log("VTEX Ads: Ignored invalid URL prefix:",s);const n=new URLSearchParams(e.split("?")[1]);if(!l.has("utm_source")&&n.has("publisher_id")&&n.get("publisher_id")===r.publisher_id)return void o.log("VTEX Ads: publisher_id is equal to nopid, event not sent.");if(n.has("campaign_type")||n.set("campaign_type","off_site"),n.has("nopid")||n.set("nopid",r.publisher_id),n.has("request_id")){const e=n.get("request_id");n.delete("request_id"),n.set("origin_request_id",e)}if(!n.has("request_id")){const e=i.randomUUID();n.set("request_id",e)}if(n.has("event_id")){const e=n.get("event_id");n.delete("event_id"),n.set("origin_event_id",e)}if(!n.has("event_id")){const e=i.randomUUID();n.set("event_id",e)}if(n.has("user_id")){const e=n.get("user_id");n.delete("user_id"),n.set("origin_user_id",e)}if(n.has("session_id")){const e=n.get("session_id");n.delete("session_id"),n.set("origin_session_id",e)}if(n.has("gadv_id")){const e=n.get("gadv_id");n.delete("gadv_id"),n.set("track_id",e)}n.set("session_id",c);const a=["https://",s.hostname,s.pathname].join("")+"?"+n.toString();t.sendBeacon(a,JSON.stringify({campaign_type:"off_site",session_id:c})),o.log("VTEX Ads: Beacon sent to",a)}catch(e){o.error("VTEX Ads: Failed to decode tracking URL:",e)}else{const e=l.get("track_id");await VTEXAdsBeaconSender({publisher_id:r.publisher_id,session_id:c,track_id:e,cryptoObj:i,navigatorObj:t,consoleObj:o,documentObj:s})}}"undefined"!=typeof window&&"undefined"==typeof module&&async function(){await VTEXAdsAgent()}(),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports={VTEXAdsAgent:VTEXAdsAgent,VTEXAdsBeaconSender:VTEXAdsBeaconSender,VTEXAdsGetCookieValue:VTEXAdsGetCookieValue,VTEXAdsGetSessionId:VTEXAdsGetSessionId,VTEXAdsGetSessionIdWithRetry:VTEXAdsGetSessionIdWithRetry,GET_MAC_ID_INTERVAL:GET_MAC_ID_INTERVAL});